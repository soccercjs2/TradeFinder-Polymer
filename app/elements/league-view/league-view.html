<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-request.html">

<dom-module id="league-view">
    <template>
        <style>
            /* local DOM styles go here */
            
        </style>
        <!-- local DOM goes here -->
        <!--params='{"username":"{{league.username}}", "password":"{{league.password}}"}'-->
        <!--body='{"username":"{{league.username}}", "password":"{{league.password}}"}'-->
        <iron-ajax
            id="league-ajax"
            method="POST"
            url="http://www.fleaflicker.com/nfl/leagues/124676/teams/878935"
            handle-as="text"
            last-error="{{ajaxResponse.message}}"
            on-response="handleResponse" verbose></iron-ajax>
        <!--<iron-request id="league-request"></iron-request>
        <!--{{leagueAjax}}-->
        <!--{{ajaxResponse}}-->
        {{ajaxResponse}}
        {{leagueFirebase.name}}
        {{leagueFirebase.url}}
    </template>
    <script>
        Polymer({
            is: 'league-view',
            properties: {
                leagueid: {
                    type: String,
                    notify: true
                },
                leagues: {
                    type: Array,
                    readonly: true
                },
                leagueFirebase: {
                    type: Object,
                    notify: true,
                    computed: '_getFirebaseLeague(leagues, leagueid)'
                },
                leagueAjax: {
                    type: Object,
                    notify: true,
                    computed: '_getAjaxLeague(leagueFirebase)'
                }  
            },
            _getFirebaseLeague: function(leagues, leagueid) {
                var filteredLeagues = leagues.filter( function(league){return (league.__firebaseKey__ == leagueid);} );
                var leagueFirebase;
                
                if (filteredLeagues) {
                    if (filteredLeagues.length == 1) {
                        leagueFirebase = filteredLeagues[0];
                    }
                }

                return leagueFirebase;
            },
            _getAjaxLeague: function(leagueFirebase) {
                if (leagueFirebase) {
                    this.$['league-ajax'].generateRequest();
                }
            },
            handleResponse: function(e) {
                alert('asdf');
            }
        });
    </script>
</dom-module>